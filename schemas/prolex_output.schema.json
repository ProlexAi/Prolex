{
  "$schema": "http://json-schema.org/draft-07/schema#",
<<<<<< claude/fix-json-schema-validation-015bQveWcNSNed8DmfLdnTXU
  "$id": "https://prolex.ai/schemas/prolex_output.schema.json",
======
  "$id": "https://automatt.ai/schemas/prolex-output.json",
>>>>>> main
  "title": "ProlexOutput",
  "description": "Format de sortie standardisé de Prolex",
  "type": "object",
  "required": ["type"],
  "oneOf": [
    {
      "properties": {
        "type": {
          "const": "answer"
        },
        "content": {
          "type": "string",
          "minLength": 1,
          "description": "Réponse textuelle pour l'utilisateur"
        }
      },
      "required": ["content"],
      "additionalProperties": false
    },
    {
      "properties": {
        "type": {
          "const": "tool_call"
        },
        "tool": {
          "type": "string",
          "pattern": "^[A-Z_]+$",
          "description": "ID de l'outil à exécuter (MAJUSCULES)"
        },
        "payload": {
          "type": "object",
          "description": "Payload JSON conforme au schéma de l'outil"
        }
      },
      "required": ["tool", "payload"],
      "additionalProperties": false
    },
    {
      "properties": {
        "type": {
          "const": "multi_tool_plan"
        },
        "plan": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["step", "tool", "payload"],
            "properties": {
              "step": {
                "type": "integer",
                "minimum": 1,
                "description": "Numéro d'étape dans le plan"
              },
              "tool": {
                "type": "string",
                "pattern": "^[A-Z_]+$",
                "description": "ID de l'outil pour cette étape"
              },
              "payload": {
                "type": "object",
                "description": "Payload pour cette étape"
              },
              "depends_on": {
                "type": "array",
                "items": {
                  "type": "integer"
                },
                "description": "Numéros d'étapes dont celle-ci dépend"
              }
            }
          },
          "description": "Plan séquentiel d'appels d'outils"
        }
      },
      "required": ["plan"],
      "additionalProperties": false
    },
    {
      "properties": {
        "type": {
          "const": "clarification"
        },
        "questions": {
          "type": "array",
          "minItems": 1,
          "maxItems": 3,
          "items": {
            "type": "string",
            "minLength": 10
          },
          "description": "Questions pour clarifier la demande (1 à 3 max)"
        }
      },
      "required": ["questions"],
      "additionalProperties": false
    }
  ]
}
